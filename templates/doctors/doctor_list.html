{% extends 'base/base.html' %}

{% block title %}Danh sách bác sĩ - {{ block.super }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-user-md"></i> Danh sách bác sĩ</h2>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addDoctorModal">
        <i class="fas fa-plus"></i> Thêm bác sĩ
    </button>
</div>

<!-- Search and Filter -->
<div class="card mb-4">
    <div class="card-body">
        <form id="search-form" class="row g-3">
            <div class="col-md-4">
                <label for="search-query" class="form-label">Tìm kiếm</label>
                <input type="text" class="form-control" id="search-query" 
                       placeholder="Tên bác sĩ, mã NV, SĐT...">
            </div>
            <div class="col-md-2">
                <label for="department-filter" class="form-label">Khoa</label>
                <select class="form-select" id="department-filter">
                    <option value="">Tất cả khoa</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="degree-filter" class="form-label">Bằng cấp</label>
                <select class="form-select" id="degree-filter">
                    <option value="">Tất cả</option>
                    <option value="BACHELOR">Bác sĩ</option>
                    <option value="MASTER">Thạc sĩ</option>
                    <option value="DOCTOR">Tiến sĩ</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="status-filter" class="form-label">Trạng thái</label>
                <select class="form-select" id="status-filter">
                    <option value="">Tất cả</option>
                    <option value="true">Đang hoạt động</option>
                    <option value="false">Tạm nghỉ</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-outline-primary d-block">
                    <i class="fas fa-search"></i> Tìm kiếm
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Doctor Table -->
<div class="card">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Danh sách bác sĩ</h5>
            <small class="text-muted">Tổng: <span id="total-count">0</span> bác sĩ</small>
        </div>
        
        <div class="table-responsive">
            <table class="table table-hover text-center align-middle" id="doctors-table">
                <thead class="table-light text-center">
                    <tr>
                        <th>Mã BS</th>
                        <th>Họ tên</th>
                        <th>Khoa</th>
                        <th>Chuyên khoa</th>
                        <th>Liên hệ</th>
                        <th>Kinh nghiệm</th>
                        <th>Trạng thái</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="doctors-table-body" class="text-center">
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Đang tải...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav id="pagination-nav" class="mt-3">
            <ul class="pagination justify-content-center" id="pagination-container">
                <!-- Pagination will be rendered here -->
            </ul>
        </nav>
    </div>
</div>

<!-- Add Doctor Modal -->
<div class="modal fade" id="addDoctorModal" tabindex="-1" aria-labelledby="addDoctorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addDoctorModalLabel">
                    <i class="fas fa-user-md"></i> Thêm bác sĩ mới
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="add-doctor-form">
                <div class="modal-body">
                    <!-- User Information -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-user"></i> Thông tin tài khoản</h6>
                            <hr>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="username" class="form-label">Tên đăng nhập <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="username" name="username" required>
                        </div>
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="first_name" class="form-label">Họ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="first_name" name="first_name" required>
                        </div>
                        <div class="col-md-6">
                            <label for="last_name" class="form-label">Tên <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="last_name" name="last_name" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="password" class="form-label">Mật khẩu <span class="text-danger">*</span></label>
                            <input type="password" class="form-control" id="password" name="password" required>
                        </div>
                        <div class="col-md-6">
                            <label for="phone_number" class="form-label">Số điện thoại</label>
                            <input type="tel" class="form-control" id="phone_number" name="phone_number">
                        </div>
                    </div>

                    <!-- Doctor Profile Information -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-stethoscope"></i> Thông tin chuyên môn</h6>
                            <hr>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="employee_id" class="form-label">Mã nhân viên <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="employee_id" name="employee_id" required>
                        </div>
                        <div class="col-md-6">
                            <label for="license_number" class="form-label">Số chứng chỉ hành nghề <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="license_number" name="license_number" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="department" class="form-label">Khoa <span class="text-danger">*</span></label>
                            <select class="form-select" id="department" name="department" required>
                                <option value="">Chọn khoa...</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="degree" class="form-label">Bằng cấp <span class="text-danger">*</span></label>
                            <select class="form-select" id="degree" name="degree" required>
                                <option value="">Chọn bằng cấp...</option>
                                <option value="BACHELOR">Bác sĩ</option>
                                <option value="MASTER">Thạc sĩ</option>
                                <option value="DOCTOR">Tiến sĩ</option>
                                <option value="PROFESSOR">Giáo sư</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="specializations" class="form-label">Chuyên khoa <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="specializations" name="specializations" required
                                   placeholder="VD: Tim mạch, Nội khoa...">
                        </div>
                        <div class="col-md-6">
                            <label for="years_of_experience" class="form-label">Năm kinh nghiệm <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="years_of_experience" name="years_of_experience" min="0" max="50" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="max_patients_per_day" class="form-label">Số bệnh nhân tối đa/ngày <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="max_patients_per_day" name="max_patients_per_day" 
                                   min="1" max="100" value="40" required placeholder="VD: 40">
                        </div>
                        <div class="col-md-6">
                            <label for="consultation_duration" class="form-label">Thời gian khám/bệnh nhân (phút) <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="consultation_duration" name="consultation_duration" 
                                   min="5" max="120" value="15" required placeholder="VD: 15">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="qualifications" class="form-label">Bằng cấp & Chứng chỉ</label>
                            <textarea class="form-control" id="qualifications" name="qualifications" rows="3"
                                      placeholder="Mô tả các bằng cấp, chứng chỉ, giải thưởng..."></textarea>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="bio" class="form-label">Tiểu sử</label>
                            <textarea class="form-control" id="bio" name="bio" rows="3"
                                      placeholder="Mô tả ngắn về bác sĩ..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Lưu bác sĩ
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Doctor Modal -->
<div class="modal fade" id="editDoctorModal" tabindex="-1" aria-labelledby="editDoctorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editDoctorModalLabel">
                    <i class="fas fa-edit"></i> Chỉnh sửa thông tin bác sĩ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="edit-doctor-form">
                <input type="hidden" id="edit-doctor-id" name="doctor_id">
                <div class="modal-body">
                    <!-- Same form fields as add modal, but with edit- prefix for IDs -->
                    <!-- User Information -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-user"></i> Thông tin tài khoản</h6>
                            <hr>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-username" class="form-label">Tên đăng nhập <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="edit-username" name="username" required>
                        </div>
                        <div class="col-md-6">
                            <label for="edit-email" class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="edit-email" name="email" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-first_name" class="form-label">Họ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="edit-first_name" name="first_name" required>
                        </div>
                        <div class="col-md-6">
                            <label for="edit-last_name" class="form-label">Tên <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="edit-last_name" name="last_name" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-phone_number" class="form-label">Số điện thoại</label>
                            <input type="tel" class="form-control" id="edit-phone_number" name="phone_number">
                        </div>
                        <div class="col-md-6">
                            <label for="edit-is_active" class="form-label">Trạng thái</label>
                            <select class="form-select" id="edit-is_active" name="is_active">
                                <option value="true">Đang hoạt động</option>
                                <option value="false">Tạm nghỉ</option>
                            </select>
                        </div>
                    </div>

                    <!-- Doctor Profile Information -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-stethoscope"></i> Thông tin chuyên môn</h6>
                            <hr>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-employee_id" class="form-label">Mã nhân viên <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="edit-employee_id" name="employee_id" required>
                        </div>
                        <div class="col-md-6">
                            <label for="edit-department" class="form-label">Khoa <span class="text-danger">*</span></label>
                            <select class="form-select" id="edit-department" name="department" required>
                                <option value="">Chọn khoa...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-degree" class="form-label">Bằng cấp <span class="text-danger">*</span></label>
                            <select class="form-select" id="edit-degree" name="degree" required>
                                <option value="">Chọn bằng cấp...</option>
                                <option value="BACHELOR">Bác sĩ</option>
                                <option value="MASTER">Thạc sĩ</option>
                                <option value="DOCTOR">Tiến sĩ</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="edit-years_of_experience" class="form-label">Năm kinh nghiệm</label>
                            <input type="number" class="form-control" id="edit-years_of_experience" name="years_of_experience" min="0">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="edit-specializations" class="form-label">Chuyên khoa</label>
                            <input type="text" class="form-control" id="edit-specializations" name="specializations" 
                                   placeholder="VD: Tim mạch, Nội khoa...">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-max_patients_per_day" class="form-label">Số bệnh nhân tối đa/ngày</label>
                            <input type="number" class="form-control" id="edit-max_patients_per_day" name="max_patients_per_day" 
                                   min="1" max="100" placeholder="VD: 40">
                        </div>
                        <div class="col-md-6">
                            <label for="edit-consultation_duration" class="form-label">Thời gian khám/bệnh nhân (phút)</label>
                            <input type="number" class="form-control" id="edit-consultation_duration" name="consultation_duration" 
                                   min="5" max="120" placeholder="VD: 15">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="edit-qualifications" class="form-label">Bằng cấp & Chứng chỉ</label>
                            <textarea class="form-control" id="edit-qualifications" name="qualifications" rows="3"
                                      placeholder="Mô tả các bằng cấp, chứng chỉ, giải thưởng..."></textarea>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="edit-bio" class="form-label">Tiểu sử</label>
                            <textarea class="form-control" id="edit-bio" name="bio" rows="3"
                                      placeholder="Mô tả ngắn về bác sĩ..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Cập nhật
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Doctor Detail Modal -->
<div class="modal fade" id="doctorDetailModal" tabindex="-1" aria-labelledby="doctorDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="doctorDetailModalLabel">
                    <i class="fas fa-user-md"></i> Thông tin chi tiết bác sĩ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="doctor-detail-content">
                <!-- Doctor details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" onclick="editDoctorFromDetail()">
                    <i class="fas fa-edit"></i> Chỉnh sửa
                </button>
            </div>
        </div>
    </div>
</div>

<!-- View Doctor Modal -->
<div class="modal fade" id="viewDoctorModal" tabindex="-1" aria-labelledby="viewDoctorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewDoctorModalLabel">
                    <i class="fas fa-user-md"></i> Thông tin bác sĩ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-borderless">
                            <tr>
                                <td><strong>Mã nhân viên:</strong></td>
                                <td id="view-employee-id"></td>
                            </tr>
                            <tr>
                                <td><strong>Họ tên:</strong></td>
                                <td id="view-full-name"></td>
                            </tr>
                            <tr>
                                <td><strong>Email:</strong></td>
                                <td id="view-email"></td>
                            </tr>
                            <tr>
                                <td><strong>SĐT:</strong></td>
                                <td id="view-phone"></td>
                            </tr>
                            <tr>
                                <td><strong>Ngày sinh:</strong></td>
                                <td id="view-birth-date"></td>
                            </tr>
                            <tr>
                                <td><strong>Giới tính:</strong></td>
                                <td id="view-gender"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-borderless">
                            <tr>
                                <td><strong>Bằng cấp:</strong></td>
                                <td id="view-degree"></td>
                            </tr>
                            <tr>
                                <td><strong>Khoa:</strong></td>
                                <td id="view-department"></td>
                            </tr>
                            <tr>
                                <td><strong>Chuyên khoa:</strong></td>
                                <td id="view-specializations"></td>
                            </tr>
                            <tr>
                                <td><strong>Kinh nghiệm:</strong></td>
                                <td id="view-experience"></td>
                            </tr>
                            <tr>
                                <td><strong>Số chứng chỉ:</strong></td>
                                <td id="view-license"></td>
                            </tr>
                            <tr>
                                <td><strong>Trạng thái:</strong></td>
                                <td id="view-status"></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Doctor Modal -->
<div class="modal fade" id="editDoctorModal" tabindex="-1" aria-labelledby="editDoctorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editDoctorModalLabel">
                    <i class="fas fa-edit"></i> Chỉnh sửa thông tin bác sĩ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="edit-doctor-form">
                <div class="modal-body">
                    <input type="hidden" id="edit-doctor-id" name="id">
                    
                    <!-- User Information -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-user"></i> Thông tin cá nhân</h6>
                            <hr>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-first-name" class="form-label">Họ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="edit-first-name" name="first_name" required>
                        </div>
                        <div class="col-md-6">
                            <label for="edit-last-name" class="form-label">Tên <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="edit-last-name" name="last_name" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-email" class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="edit-email" name="email" required>
                        </div>
                        <div class="col-md-6">
                            <label for="edit-phone" class="form-label">Số điện thoại <span class="text-danger">*</span></label>
                            <input type="tel" class="form-control" id="edit-phone" name="phone_number" required>
                        </div>
                    </div>
                    
                    <!-- Professional Information -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-stethoscope"></i> Thông tin chuyên môn</h6>
                            <hr>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-license-number" class="form-label">Số chứng chỉ hành nghề <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="edit-license-number" name="license_number" required>
                        </div>
                        <div class="col-md-6">
                            <label for="edit-degree" class="form-label">Bằng cấp <span class="text-danger">*</span></label>
                            <select class="form-select" id="edit-degree" name="degree" required>
                                <option value="">Chọn bằng cấp</option>
                                <option value="BACHELOR">Bác sĩ</option>
                                <option value="MASTER">Thạc sĩ</option>
                                <option value="DOCTOR">Tiến sĩ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit-department" class="form-label">Khoa <span class="text-danger">*</span></label>
                            <select class="form-select" id="edit-department" name="department" required>
                                <option value="">Chọn khoa</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="edit-experience-years" class="form-label">Số năm kinh nghiệm</label>
                            <input type="number" class="form-control" id="edit-experience-years" name="experience_years" min="0">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-12">
                            <label for="edit-specialization" class="form-label">Chuyên khoa</label>
                            <textarea class="form-control" id="edit-specialization" name="specialization" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="edit-is-active" name="is_active" value="true">
                                <label class="form-check-label" for="edit-is-active">
                                    Đang hoạt động
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Cập nhật
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% load static %}
<script src="{% static 'js/doctors.js' %}"></script>
{% endblock %}
